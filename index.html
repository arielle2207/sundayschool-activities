<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sunday School Game Library</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">

    <div class="header">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div style="font-weight:1000;font-size:16px;">Sunday School Games</div>
          <div style="color:var(--muted);font-weight:800;font-size:13px;">Pick a game to play together</div>
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <a class="btn btn-primary" href="index.html" style="text-decoration:none;">Games</a>
        <a class="btn" href="README.html" style="text-decoration:none;display:none;">About</a>
      </div>
    </div>

    <h1>Game Library</h1>
    <div class="sub">Choose an activity. Add new games by adding a JSON file to <b>/games</b> and listing it in <b>manifest.json</b>.</div>

    <div id="status"></div>
    <div class="grid" id="grid"></div>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const statusEl = document.getElementById("status");

    function openGame(gameFile){
      window.location.href = `play.html?game=${encodeURIComponent(gameFile)}`;
    }

    function typeLabel(t){
      if(t === "reorder") return "Reorder";
      if(t === "wordsearch") return "Word Search";
      return t || "Game";
    }

    async function loadLibrary(){
      try{
        const manifest = await (await fetch("games/manifest.json")).json();

        for(const file of manifest.games){
          const data = await (await fetch(`games/${file}`)).json();

          const card = document.createElement("div");
          card.className = "card";
          card.onclick = () => openGame(file);

          card.innerHTML = `
            <div class="title">${data.title || file}</div>
            <div class="desc">${data.description || ""}</div>
            <div class="meta">
              <span class="tag">${typeLabel(data.type)}</span>
              ${data.age ? `<span class="tag tag2">Age ${data.age}</span>` : ""}
            </div>
          `;
          grid.appendChild(card);
        }
      }catch(e){
        statusEl.innerHTML = `<div class="err">Could not load games. Make sure you are running Live Server and that games/manifest.json exists.</div>`;
        console.error(e);
      }
    }

    loadLibrary();
  </script>
</body>
</html>
